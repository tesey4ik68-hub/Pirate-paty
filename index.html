<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∏—Ä–∞—Ç—Å–∫–∏—Ö –±–∏–ª–µ—Ç–æ–≤</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('https://i.yapx.ru/aZGzI.png') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Arial', sans-serif;
      color: #f5d76e;
    }
    .overlay {
      background: rgba(0, 0, 0, 0.8);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(0, 0, 0, 0.7);
      border: 3px solid #b8860b;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 20px #b8860b;
    }
    h1 {
      font-family: 'MedievalSharp', cursive;
      text-align: center;
      color: #d4af37;
      font-size: 2.2em;
      text-shadow: 2px 2px 5px #000;
    }
    label {
      display: block;
      margin: 15px 0 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #b8860b;
      background: #111;
      color: #fff;
      border-radius: 5px;
    }
    button {
      background: #b8860b;
      color: white;
      border: none;
      padding: 12px 20px;
      margin: 20px 5px 20px 0;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }
    button:hover {
      background: #d4af37;
    }
    #result {
      display: none;
      margin-top: 30px;
      border: 2px solid #8b4513;
      padding: 15px;
      border-radius: 10px;
      background: rgba(139, 69, 19, 0.2);
    }
    .ticket-link {
      color: #4fc3f7;
      word-break: break-all;
      font-family: monospace;
      font-size: 0.9em;
    }
    .pirate-symbol {
      color: #ffcc00;
    }
    .warning {
      background-color: #b8860b;
      color: #000;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      font-weight: bold;
    }
    .pass-list {
      margin-top: 30px;
      border: 2px solid #8b4513;
      padding: 15px;
      border-radius: 10px;
      background: rgba(139, 69, 19, 0.2);
      max-height: 400px;
      overflow-y: auto;
    }
    .pass-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #b8860b;
    }
    .pass-item:last-child {
      border-bottom: none;
    }
    
    .pass-number {
      background: #4169e1;
      color: white;
      padding: 3px 8px;
      border-radius: 5px;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .copy-pass-number-btn {
      background: #4169e1;
      color: white;
      border: none;
      padding: 5px 10px;
      margin-left: 5px;
      font-size: 0.9em;
      cursor: pointer;
      border-radius: 5px;
    }
    
    .copy-pass-number-btn:hover {
      background: #6495ed;
    }
    .pass-info {
      flex-grow: 1;
    }
    .pass-actions button {
      margin: 0 2px;
      padding: 5px 10px;
      font-size: 0.9em;
    }
    .copy-btn {
      background: #4169e1;
    }
    .copy-btn:hover {
      background: #6495ed;
    }
    .delete-btn {
      background: #8b0000;
    }
    .delete-btn:hover {
      background: #a52a2a;
    }
    .view-btn {
      background: #006400;
    }
    .view-btn:hover {
      background: #228b22;
    }
    .share-btn {
      background: #4169e1;
    }
    .share-btn:hover {
      background: #6495ed;
    }
    .table-group {
      margin-top: 20px;
      border: 1px solid #b8860b;
      border-radius: 5px;
      padding: 10px;
      background: rgba(184, 134, 11, 0.1);
    }
    .table-header {
      font-weight: bold;
      color: #d4af37;
      border-bottom: 1px solid #b8860b;
      padding-bottom: 5px;
      margin-bottom: 10px;
    }
    .table-pass-item {
      padding: 5px 0;
      border-bottom: 1px dashed #b8860b;
    }
    .table-pass-item:last-child {
      border-bottom: none;
    }
    #copy-button {
      background: #4169e1;
      color: white;
      border: none;
      padding: 12px 20px;
      margin: 10px 5px 10px 0;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }
    
    #copy-button:hover {
      background: #6495ed;
    }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="container">
      <h1>üè¥‚Äç‚ò†Ô∏è –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∏—Ä–∞—Ç—Å–∫–∏—Ö –ø—Ä–æ–ø—É—Å–∫–æ–≤</h1>

      <div class="warning">
        ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞ –¥–ª—è —Ç–æ–≥–æ –∂–µ –∏–º–µ–Ω–∏ –∏–ª–∏ –º–µ—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã!
      </div>

      <label for="name">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –≥–æ—Å—Ç—è</label>
      <input type="text" id="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–æ—à–Ω–∏–∫–æ–≤–∞ –ì–∞–ª–∏–Ω–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞" />

      <label for="gender">–ü–æ–ª –≥–æ—Å—Ç—è</label>
      <select id="gender">
        <option value="male">–ú—É–∂—Å–∫–æ–π</option>
        <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
      </select>

      <label for="table">–ù–æ–º–µ—Ä —Å—Ç–æ–ª–∞</label>
      <select id="table">
        <option value="1">–°—Ç–æ–ª ‚Ññ1</option>
        <option value="2">–°—Ç–æ–ª ‚Ññ2</option>
        <option value="3">–°—Ç–æ–ª ‚Ññ3</option>
        <option value="4">–°—Ç–æ–ª ‚Ññ4</option>
        <option value="5">–°—Ç–æ–ª ‚Ññ5</option>
        <option value="6">–°—Ç–æ–ª ‚Ññ6</option>
        <option value="7">–°—Ç–æ–ª ‚Ññ7</option>
        <option value="8">–°—Ç–æ–ª ‚Ññ8</option>
        <option value="9">–°—Ç–æ–ª ‚Ññ9</option>
        <option value="10">–°—Ç–æ–ª ‚Ññ10</option>
        <option value="11">–°—Ç–æ–ª ‚Ññ11</option>
        <option value="12">–°—Ç–æ–ª ‚Ññ12</option>
        <option value="13" selected>–°—Ç–æ–ª ‚Ññ13</option>
        <option value="14">–°—Ç–æ–ª ‚Ññ14</option>
        <option value="15">–°—Ç–æ–ª ‚Ññ15</option>
      </select>

      <label for="seat">–ú–µ—Å—Ç–æ –∑–∞ —Å—Ç–æ–ª–æ–º</label>
      <input type="number" id="seat" min="1" max="10" value="1" />

      <button onclick="generate()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç üè¥‚Äç‚ò†Ô∏è</button>
      <button onclick="loadPasses()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
      <button onclick="showTableGroups()">–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–ª–∞–º</button>

      <div id="result">
        <h2>–ì–æ—Ç–æ–≤–æ! <span class="pirate-symbol">‚öì</span> –ü—Ä–æ–ø—É—Å–∫ –¥–ª—è <span id="result-name"></span></h2>
        
        <p><strong>–ü–æ–ª:</strong> <span id="result-gender"></span></p>
        <p><strong>–°—Ç–æ–ª:</strong> <span id="result-table"></span></p>
        <p><strong>–ú–µ—Å—Ç–æ:</strong> <span id="result-seat"></span></p>

        <p><strong>–°—Å—ã–ª–∫–∞ –Ω–∞ –±–∏–ª–µ—Ç:</strong></p>
        <div class="ticket-link" id="ticket-link"></div>

        <p style="font-size:0.9em; margin-top:20px;">
          –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≥–æ—Å—Ç—é –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–º—É –ø—Ä–æ–ø—É—Å–∫—É.
        </p>
        
        <button id="copy-button" style="display:none;" onclick="copyInvitation()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</button>
      </div>

      <div class="pass-list">
        <h2>–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏</h2>
        <div id="passes-container">
          <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è)
    function initPassStorage() {
      // –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –≥–æ—Å—Ç—è
    function getGuestType(name, gender) {
      const fullName = name.toLowerCase();
      
      if (fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ')) {
        return {
          isRoyal: true,
          type: gender === 'male' ? '–∫–æ—Ä–æ–ª—å' : '–∫–æ—Ä–æ–ª–µ–≤–∞',
          number: gender === 'male' ? '1' : '2'
        };
      } 
      else if (fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && gender === 'female') {
        return {
          isRoyal: true,
          type: '–ø—Ä–∏–Ω—Ü–µ—Å—Å–∞',
          number: '3'
        };
      }
      else if (fullName.includes('–±—É—Ä–µ—Ü') && gender === 'male') {
        return {
          isRoyal: true,
          type: '–ø—Ä–∏–Ω—Ü',
          number: '4'
        };
      }
      else {
        return {
          isRoyal: false,
          type: '–æ–±—ã—á–Ω—ã–π –≥–æ—Å—Ç—å'
        };
      }
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –±–∏–ª–µ—Ç–∞
    function getTicketFileName(name, gender) {
      const fullName = name.toLowerCase();
      
      if (fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ')) {
        return gender === 'male' ? 'ticket_royal_male.html' : 'ticket_royal_female.html';
      } 
      else if (fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && gender === 'female') {
        return 'ticket_princess.html';
      }
      else if (fullName.includes('–±—É—Ä–µ—Ü') && gender === 'male') {
        return 'ticket_prince.html';
      }
      else {
        return gender === 'female' ? 'ticket_female.html' : 'ticket.html';
      }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ –ø—Ä–æ–ø—É—Å–∫–∞
    function generatePassNumber(name, gender, table, seat) {
      const guestInfo = getGuestType(name, gender);
      
      if (guestInfo.isRoyal) {
        return guestInfo.number;
      } else {
        // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –≥–æ—Å—Ç–µ–π: ‚Ññ—Å—Ç–æ–ª–∞ + –Ω–æ–º–µ—Ä –º–µ—Å—Ç–∞
        return `${table}${seat}`;
      }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞
    function savePass(name, gender, table, seat) {
      const passNumber = generatePassNumber(name, gender, table, seat);
      
      const pass = {
        name: name,
        gender: gender,
        table_number: table,
        seat_number: seat,
        pass_number: passNumber
      };
      
      // Common function to handle API responses
      function handleApiResponse(response) {
        // Check if response is OK (status 200-299)
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        // Check if response is JSON
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          throw new Error('Server responded with non-JSON data');
        }
        
        return response.json();
      }

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      fetch('/server/api.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(pass)
      })
      .then(handleApiResponse)
      .then(data => {
        if (data.error) {
          if (data.error.includes('—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç')) {
            // –ï—Å–ª–∏ –ø—Ä–æ–ø—É—Å–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
            updatePass(name, gender, table, seat);
          } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞: ' + data.error);
          }
        } else {
          console.log('–ü—Ä–æ–ø—É—Å–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }
      })
      .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞: ' + error.message);
      });
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞
    function deletePass(name) {
      if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫ –¥–ª—è ${name}?`)) {
        return;
      }
      
      const data = { name: name };
      
      fetch('server/api.php', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(handleApiResponse)
      .then(data => {
        if (data.error) {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞: ' + data.error);
        } else {
          console.log('–ü—Ä–æ–ø—É—Å–∫ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
          loadPasses(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        }
      })
      .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞: ' + error.message);
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
    function sharePass(name, gender, table, seat, passNumber) {
      const baseUrl = window.location.href.replace('index.html', '');
      const ticketFileName = getTicketFileName(name, gender);
      const ticketUrl = `${baseUrl}${ticketFileName}?name=${encodeURIComponent(name)}&gender=${gender}&table=${table}&seat=${seat}&passNumber=${encodeURIComponent(passNumber)}`;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≥–æ—Å—Ç—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
      const fullName = name.toLowerCase();
      let shareText;
      
      if (fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ')) {
        shareText = `üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, –í–∞—à–µ –í–µ–ª–∏—á–µ—Å—Ç–≤–æ ${name}!\n\n–í–æ—Ç –≤–∞—à –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\n‚öúÔ∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      } else if (fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && gender === 'female') {
        shareText = `üë∏ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω–∞—è –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞ ${name}!\n\n–í–æ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\nüéÄ –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      } else if (fullName.includes('–±—É—Ä–µ—Ü') && gender === 'male') {
        shareText = `ü§¥ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω—ã–π –ø—Ä–∏–Ω—Ü ${name}!\n\n–í–æ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–∞ –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\nüõ°Ô∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      } else {
        shareText = `üè¥‚Äç‚ò†Ô∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, ${name}!\n\n–í–æ—Ç –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\n‚öì –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Web Share API
      if (navigator.share) {
        navigator.share({
          title: fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ') ? '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫' : 
                 fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && gender === 'female' ? '–ü—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã –ø–∏—Ä–∞—Ç–æ–≤' : 
                 fullName.includes('–±—É—Ä–µ—Ü') && gender === 'male' ? '–ü—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–∞ –ø–∏—Ä–∞—Ç–æ–≤' :
                 '–ü–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫',
          text: shareText,
          url: ticketUrl
        }).catch(error => {
          console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è:', error);
          copyToClipboard(shareText);
        });
      } else {
        copyToClipboard(shareText);
      }
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    function copyToClipboard(text, html) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
      if (navigator.clipboard) {
        // –ö–æ–ø–∏—Ä—É–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
        navigator.clipboard.writeText(text).then(() => {
          alert("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
        }).catch(err => {
          console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞: ', err);
          fallbackCopyText(text);
        });
      } else {
        // –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        fallbackCopyText(text);
      }
    }
    
    // –†–µ–∑–µ—Ä–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    function fallbackCopyText(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand("copy");
        alert("–°—Å—ã–ª–∫–∞ –∏ —Ç–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
      } catch (err) {
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ', err);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.");
      } finally {
        document.body.removeChild(textArea);
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤
    function loadPasses() {
      fetch('/server/api.php')
        .then(response => response.json())
        .then(passes => {
          if (!Array.isArray(passes) && passes.error) {
            throw new Error(passes.error);
          }
          
          const container = document.getElementById('passes-container');
          
          if (passes.length === 0) {
            container.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞.</p>';
            return;
          }
          
          container.innerHTML = passes.map(pass => {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≥–æ—Å—Ç—è
            const fullName = pass.name.toLowerCase();
            let royalSymbol = '';
            let guestType = '';
            
            if (fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ')) {
              royalSymbol = pass.gender === 'male' ? 'üëë' : 'üëë';
              guestType = ' (–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π)';
            } else if (fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && pass.gender === 'female') {
              royalSymbol = 'üë∏';
              guestType = ' (–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞)';
            } else if (fullName.includes('–±—É—Ä–µ—Ü') && pass.gender === 'male') {
              royalSymbol = 'ü§¥';
              guestType = ' (–ü—Ä–∏–Ω—Ü)';
            }
            
            return `
              <div class="pass-item">
                <div class="pass-info">
                  <strong>${royalSymbol} ${pass.name}</strong> ${guestType} (${pass.gender === 'male' ? '–ú' : '–ñ'})<br>
                  –°—Ç–æ–ª: ${pass.table_number}, –ú–µ—Å—Ç–æ: ${pass.seat_number}, ‚Ññ: ${pass.pass_number}
                </div>
                <div class="pass-actions">
                  <button class="view-btn" onclick="viewPass('${pass.name}', '${pass.gender}', '${pass.table_number}', '${pass.seat_number}', '${pass.pass_number}')">–û—Ç–∫—Ä—ã—Ç—å</button>
                  <button class="share-btn" onclick="sharePass('${pass.name}', '${pass.gender}', '${pass.table_number}', '${pass.seat_number}', '${pass.pass_number}')">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                  <button class="copy-btn" onclick="copyPassInvitation('${pass.name}', '${pass.gender}', '${pass.table_number}', '${pass.seat_number}', '${pass.pass_number}')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                  <button class="delete-btn" onclick="deletePass('${pass.name}')">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
              </div>
            `;
          }).join('');
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤:', error);
          document.getElementById('passes-container').innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤: ' + error.message + '</p>';
        });
    }

    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–ª–∞–º
    function showTableGroups() {
      initPassStorage();
      const passes = JSON.parse(localStorage.getItem('piratePasses'));
      const container = document.getElementById('passes-container');
      
      if (passes.length === 0) {
        container.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞.</p>';
        return;
      }
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å—Ç–æ–ª–∞–º
      const tables = {};
      passes.forEach(pass => {
        if (!tables[pass.table]) {
          tables[pass.table] = [];
        }
        tables[pass.table].push(pass);
      });
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–æ–ª—ã –∏ –≥–æ—Å—Ç–µ–π
      const sortedTables = Object.keys(tables).sort((a, b) => parseInt(a) - parseInt(b));
      
      container.innerHTML = sortedTables.map(table => `
        <div class="table-group">
          <div class="table-header">–°—Ç–æ–ª ‚Ññ${table}</div>
          ${tables[table].map(pass => {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≥–æ—Å—Ç—è
            const fullName = pass.name.toLowerCase();
            let royalSymbol = '';
            let guestType = '';
            
            if (fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ')) {
              royalSymbol = pass.gender === 'male' ? 'üëë' : 'üëë';
              guestType = ' (–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π)';
            } else if (fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && pass.gender === 'female') {
              royalSymbol = 'üë∏';
              guestType = ' (–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞)';
            } else if (fullName.includes('–±—É—Ä–µ—Ü') && pass.gender === 'male') {
              royalSymbol = 'ü§¥';
              guestType = ' (–ü—Ä–∏–Ω—Ü)';
            }
            
            return `
              <div class="table-pass-item">
                <strong>${royalSymbol} ${pass.name}</strong> ${guestType} (${pass.gender === 'male' ? '–ú' : '–ñ'}) - –ú–µ—Å—Ç–æ: ${pass.seat}, ‚Ññ: ${pass.passNumber}
                <div style="float: right;">
                  <button class="view-btn" onclick="viewPass('${pass.name}', '${pass.gender}', '${pass.table}', '${pass.seat}', '${pass.passNumber}')" style="padding: 2px 5px; font-size: 0.8em;">–û—Ç–∫—Ä—ã—Ç—å</button>
                  <button class="share-btn" onclick="sharePass('${pass.name}', '${pass.gender}', '${pass.table}', '${pass.seat}', '${pass.passNumber}')" style="padding: 2px 5px; font-size: 0.8em;">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                  <button class="copy-btn" onclick="copyPassInvitation('${pass.name}', '${pass.gender}', '${pass.table}', '${pass.seat}', '${pass.passNumber}')" style="padding: 2px 5px; font-size: 0.8em;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                  <button class="delete-btn" onclick="deletePass('${pass.name}')" style="padding: 2px 5px; font-size: 0.8em;">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `).join('');
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞
    function viewPass(name, gender, table, seat, passNumber) {
      const ticketUrl = `${getTicketFileName(name, gender)}?name=${encodeURIComponent(name)}&gender=${gender}&table=${table}&seat=${seat}&passNumber=${encodeURIComponent(passNumber)}`;
      window.open(ticketUrl, '_blank');
    }

    // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
    function copyInvitation() {
      const name = document.getElementById("result-name").textContent;
      const gender = document.getElementById("result-gender").textContent;
      const table = document.getElementById("result-table").textContent;
      const seat = document.getElementById("result-seat").textContent;
      const ticketLink = document.querySelector("#ticket-link a").href;
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞
      const passNumber = generatePassNumber(name, gender === '–ú—É–∂—Å–∫–æ–π' ? 'male' : 'female', table, seat);
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≥–æ—Å—Ç—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
      const fullName = name.toLowerCase();
      let shareText;
      
      if (fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ')) {
        shareText = `üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, –í–∞—à–µ –í–µ–ª–∏—á–µ—Å—Ç–≤–æ ${name}!\n\n–í–æ—Ç –≤–∞—à –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}:\n\n${ticketLink}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\n‚öúÔ∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      } else if (fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && gender === '–ñ–µ–Ω—Å–∫–∏–π') {
        shareText = `üë∏ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω–∞—è –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞ ${name}!\n\n–í–æ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}:\n\n${ticketLink}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\nüéÄ –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      } else if (fullName.includes('–±—É—Ä–µ—Ü') && gender === '–ú—É–∂—Å–∫–æ–π') {
        shareText = `ü§¥ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω—ã–π –ø—Ä–∏–Ω—Ü ${name}!\n\n–í–æ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–∞ –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}:\n\n${ticketLink}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\nüõ°Ô∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      } else {
        shareText = `üè¥‚Äç‚ò†Ô∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, ${name}!\n\n–í–æ—Ç –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}:\n\n${ticketLink}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\n‚öì –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
      }
      
      // –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
      copyToClipboard(shareText);
    }
    
    function generate() {
      console.log("–§—É–Ω–∫—Ü–∏—è generate() –≤—ã–∑–≤–∞–Ω–∞");
      
      try {
        const name = document.getElementById("name").value.trim();
        const gender = document.getElementById("gender").value;
        const table = document.getElementById("table").value;
        const seat = document.getElementById("seat").value;

        console.log("–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:", {name, gender, table, seat});

        if (!name) {
          alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é –≥–æ—Å—Ç—è!");
          console.log("–ò–º—è –Ω–µ –≤–≤–µ–¥–µ–Ω–æ, –ø–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ");
          return;
        }

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞
        const passNumber = generatePassNumber(name, gender, table, seat);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–ø—É—Å–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        savePass(name, gender, table, seat);

        // üîó –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–ø—É—Å–∫–∞
        const ticketFileName = getTicketFileName(name, gender);
        const ticketUrl = `${ticketFileName}?name=${encodeURIComponent(name)}&gender=${gender}&table=${table}&seat=${seat}&passNumber=${encodeURIComponent(passNumber)}`;
        console.log("–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π URL:", ticketUrl);

        document.getElementById("result-name").textContent = name;
        document.getElementById("result-gender").textContent = gender === 'male' ? '–ú—É–∂—Å–∫–æ–π' : '–ñ–µ–Ω—Å–∫–∏–π';
        document.getElementById("result-table").textContent = table;
        document.getElementById("result-seat").textContent = seat;
        document.getElementById("ticket-link").innerHTML = `<a href="${ticketUrl}" target="_blank">${ticketUrl}</a>`;

        // –ü–æ–∫–∞–∑–∞—Ç—å –±–ª–æ–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏ –∫–Ω–æ–ø–∫—É –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        document.getElementById("result").style.display = "block";
        document.getElementById("copy-button").style.display = "inline-block";
        console.log("–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω");
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—Å–∫–æ–≤
        loadPasses();
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–∏–ª–µ—Ç–∞:", error);
        alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–∏–ª–µ—Ç–∞: " + error.message);
      }
      
      console.log("–§—É–Ω–∫—Ü–∏—è generate() –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
    }

    // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –ø—Ä–æ–ø—É—Å–∫–∞
    function copyPassNumber(passNumber) {
      copyToClipboard(passNumber);
    }
      
    // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤
    function copyPassInvitation(name, gender, table, seat, passNumber) {
      const baseUrl = window.location.href.replace('index.html', '');
      const ticketFileName = getTicketFileName(name, gender);
      const ticketUrl = `${baseUrl}${ticketFileName}?name=${encodeURIComponent(name)}&gender=${gender}&table=${table}&seat=${seat}&passNumber=${encodeURIComponent(passNumber)}`;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≥–æ—Å—Ç—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
      const fullName = name.toLowerCase();
      let shareText;
      let shareHtml;
      
      if (fullName.includes('–ø–∞–Ω–∞–º–æ—Ä–µ–Ω–∫–æ')) {
        shareText = `üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, –í–∞—à–µ –í–µ–ª–∏—á–µ—Å—Ç–≤–æ ${name}!\n\n–í–æ—Ç –≤–∞—à –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\n‚öúÔ∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
        shareHtml = `<div style="font-family: Arial, sans-serif; max-width: 600px;">üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, –í–∞—à–µ –í–µ–ª–∏—á–µ—Å—Ç–≤–æ ${name}!<br><br>–í–æ—Ç –≤–∞—à <b>–∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}</b>:<br><br><a href="${ticketUrl}" target="_blank">${ticketUrl}</a><br><br>–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}<br><br>‚öúÔ∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!</div>`;
      } else if (fullName.includes('–≤–µ—à–∫–∏–Ω–∞') && gender === 'female') {
        shareText = `üë∏ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω–∞—è –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞ ${name}!\n\n–í–æ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\nüéÄ –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
        shareHtml = `<div style="font-family: Arial, sans-serif; max-width: 600px;">üë∏ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω–∞—è –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞ ${name}!<br><br>–í–æ—Ç –≤–∞—à <b>–ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}</b>:<br><br><a href="${ticketUrl}" target="_blank">${ticketUrl}</a><br><br>–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}<br><br>üéÄ –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!</div>`;
      } else if (fullName.includes('–±—É—Ä–µ—Ü') && gender === 'male') {
        shareText = `ü§¥ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω—ã–π –ø—Ä–∏–Ω—Ü ${name}!\n\n–í–æ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–∞ –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\nüõ°Ô∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
        shareHtml = `<div style="font-family: Arial, sans-serif; max-width: 600px;">ü§¥ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, —é–Ω—ã–π –ø—Ä–∏–Ω—Ü ${name}!<br><br>–í–æ—Ç –≤–∞—à <b>–ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–Ω—Ü–∞ –ø–∏—Ä–∞—Ç–æ–≤ ‚Ññ${passNumber}</b>:<br><br><a href="${ticketUrl}" target="_blank">${ticketUrl}</a><br><br>–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}<br><br>üõ°Ô∏è –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!</div>`;
      } else {
        shareText = `üè¥‚Äç‚ò†Ô∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, ${name}!\n\n–í–æ—Ç –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}:\n\n${ticketUrl}\n\n–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}\n\n‚öì –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!`;
        shareHtml = `<div style="font-family: Arial, sans-serif; max-width: 600px;">üè¥‚Äç‚ò†Ô∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–æ—Ä—Ç, ${name}!<br><br>–í–æ—Ç –≤–∞—à <b>–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Ä–∞—Ç—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ ‚Ññ${passNumber}</b>:<br><br><a href="${ticketUrl}" target="_blank">${ticketUrl}</a><br><br>–í–∞—à–µ –º–µ—Å—Ç–æ: —Å—Ç–æ–ª ‚Ññ${table}, –º–µ—Å—Ç–æ ‚Ññ${seat}<br><br>‚öì –ñ–¥—ë–º –≤–∞—Å 19 —Å–µ–Ω—Ç—è–±—Ä—è!</div>`;
      }
      
      // –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∏ HTML –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
      copyToClipboard(shareText, shareHtml);
    }

    // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    function copyToClipboard(text) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
      if (navigator.clipboard) {
        // –ö–æ–ø–∏—Ä—É–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
        navigator.clipboard.writeText(text).then(() => {
          alert("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
        }).catch(err => {
          console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞: ', err);
          fallbackCopyText(text);
        });
      } else {
        // –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        fallbackCopyText(text);
      }
    }
    
    // –†–µ–∑–µ—Ä–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    function fallbackCopyText(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand("copy");
        alert("–°—Å—ã–ª–∫–∞ –∏ —Ç–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
      } catch (err) {
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ', err);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.");
      } finally {
        document.body.removeChild(textArea);
      }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
      loadPasses();
    });
  </script>
</body>
</html>